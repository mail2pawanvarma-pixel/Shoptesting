<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Discounts</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #f0f8ff;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        h1, h2 {
            color: #2c5aa0;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .page {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background: #1e3d6f;
        }
        
        .product-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #2c5aa0;
        }
        
        .product-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #777;
            margin-right: 10px;
        }
        
        .discounted-price {
            font-size: 18px;
            font-weight: bold;
            color: #d40000;
            margin-right: 10px;
        }
        
        .discount-percent {
            background: #d40000;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .product-details {
            color: #555;
            margin-bottom: 5px;
        }
        
        .offer-till {
            font-size: 14px;
            color: #777;
        }
        
        .qr-code {
            text-align: center;
            margin: 20px 0;
        }
        
        .instructions {
            background: #e6f2ff;
            padding: 10px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Shopkeeper Page -->
        <div id="shopkeeper-page" class="page active">
            <h1>Create Discount Offers</h1>
            
            <div class="instructions">
                <p>Fill in your product details below. Customers will scan the QR code to see these discounts.</p>
            </div>
            
            <div class="form-group">
                <label for="product-name">Product Name</label>
                <input type="text" id="product-name" placeholder="e.g., Tata Salt">
            </div>
            
            <div class="form-group">
                <label for="mrp">MRP (₹)</label>
                <input type="number" id="mrp" placeholder="100">
            </div>
            
            <div class="form-group">
                <label for="discounted-price">Discounted Price (₹)</label>
                <input type="number" id="discounted-price" placeholder="90">
            </div>
            
            <div class="form-group">
                <label for="details">Product Details</label>
                <textarea id="details" placeholder="Describe the product" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="offer-till">Offer Valid Until</label>
                <input type="text" id="offer-till" placeholder="e.g., Today only, Until Sunday">
            </div>
            
            <button id="generate-btn">Generate QR Code</button>
        </div>
        
        <!-- QR Code Page -->
        <div id="qr-page" class="page">
            <h1>Your QR Code is Ready!</h1>
            
            <div class="instructions">
                <p>Print this QR code and display it in your shop. Customers can scan it to see the discounts.</p>
            </div>
            
            <div class="qr-code">
                <div id="qrcode"></div>
            </div>
            
            <h2>Product Preview</h2>
            <div id="product-preview"></div>
            
            <button id="back-btn">Edit Product</button>
        </div>
        
        <!-- Customer Page -->
        <div id="customer-page" class="page">
            <h1>Today's Special Discounts!</h1>
            <div id="customer-products"></div>
            <div class="instructions">
                <p>Show this page to the shopkeeper to claim your discount.</p>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
    
    <script>
        // Check if this is a customer view
        const urlParams = new URLSearchParams(window.location.search);
        const view = urlParams.get('view');
        
        if (view === 'customer') {
            showCustomerPage();
        } else {
            showShopkeeperPage();
        }
        
        // Set up event listeners
        document.getElementById('generate-btn').addEventListener('click', generateQRCode);
        document.getElementById('back-btn').addEventListener('click', showShopkeeperPage);
        
        function showShopkeeperPage() {
            document.getElementById('shopkeeper-page').classList.add('active');
            document.getElementById('qr-page').classList.remove('active');
            document.getElementById('customer-page').classList.remove('active');
        }
        
        function showQRPage() {
            document.getElementById('shopkeeper-page').classList.remove('active');
            document.getElementById('qr-page').classList.add('active');
            document.getElementById('customer-page').classList.remove('active');
        }
        
        function showCustomerPage() {
            document.getElementById('shopkeeper-page').classList.remove('active');
            document.getElementById('qr-page').classList.remove('active');
            document.getElementById('customer-page').classList.add('active');
            
            displayCustomerProducts();
        }
        
        function generateQRCode() {
            // Get product details
            const productName = document.getElementById('product-name').value;
            const mrp = document.getElementById('mrp').value;
            const discountedPrice = document.getElementById('discounted-price').value;
            const details = document.getElementById('details').value;
            const offerTill = document.getElementById('offer-till').value;
            
            // Validate inputs
            if (!productName || !mrp || !discountedPrice || !offerTill) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Calculate discount percentage
            const discountPercent = Math.round(((mrp - discountedPrice) / mrp) * 100);
            
            // Create product object
            const product = {
                name: productName,
                mrp: mrp,
                discounted: discountedPrice,
                details: details,
                offerTill: offerTill,
                discountPercent: discountPercent
            };
            
            // Encode product data for URL
            const productData = btoa(JSON.stringify(product));
            
            // Create customer URL
            const customerURL = `${window.location.origin}${window.location.pathname}?view=customer&data=${productData}`;
            
            // Generate QR code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            QRCode.toCanvas(qrContainer, customerURL, {
                width: 200,
                height: 200,
                colorDark: '#2c5aa0',
                colorLight: '#ffffff'
            }, function(error) {
                if (error) console.error(error);
            });
            
            // Display product preview
            displayProductPreview(product);
            
            // Show QR page
            showQRPage();
        }
        
        function displayProductPreview(product) {
            const previewContainer = document.getElementById('product-preview');
            
            previewContainer.innerHTML = `
                <div class="product-card">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">
                        <span class="original-price">₹${product.mrp}</span>
                        <span class="discounted-price">₹${product.discounted}</span>
                        <span class="discount-percent">${product.discountPercent}% OFF</span>
                    </div>
                    <div class="product-details">${product.details}</div>
                    <div class="offer-till">Offer valid: ${product.offerTill}</div>
                </div>
            `;
        }
        
        function displayCustomerProducts() {
            const customerContainer = document.getElementById('customer-products');
            const productData = urlParams.get('data');
            
            if (!productData) {
                customerContainer.innerHTML = '<p>No current discounts available. Please check back later.</p>';
                return;
            }
            
            try {
                // Decode product data from URL
                const product = JSON.parse(atob(productData));
                
                customerContainer.innerHTML = `
                    <div class="product-card">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">
                            <span class="original-price">₹${product.mrp}</span>
                            <span class="discounted-price">₹${product.discounted}</span>
                            <span class="discount-percent">${product.discountPercent}% OFF</span>
                        </div>
                        <div class="product-details">${product.details}</div>
                        <div class="offer-till">Offer valid: ${product.offerTill}</div>
                    </div>
                `;
            } catch (error) {
                customerContainer.innerHTML = '<p>Error loading product details. Please try scanning again.</p>';
            }
        }
    </script>
</body>
</html>